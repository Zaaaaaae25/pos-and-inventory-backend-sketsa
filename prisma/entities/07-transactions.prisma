/// ========== TRANSACTIONS ==========
model Transaction {
  id              Int      @id @default(autoincrement())
  cashierId       Int      @map("cashier_id")
  outletId        Int      @map("outlet_id")
  tableId         Int?     @map("table_id")
  orderType       String?  @map("order_type")
  total           Decimal  @db.Decimal(12, 2)
  tax             Decimal? @db.Decimal(12, 2)
  discount        Decimal? @db.Decimal(12, 2)
  paymentMethodId Int?     @map("payment_method_id")
  createdAt       DateTime @default(now()) @map("created_at")

  cashier       User           @relation("UserTransactions", fields: [cashierId], references: [id], onDelete: Restrict)
  outlet        Outlet         @relation("OutletTransactions", fields: [outletId], references: [id], onDelete: Restrict)
  table         Table?         @relation(fields: [tableId], references: [id], onDelete: SetNull)
  paymentMethod PaymentMethod? @relation(fields: [paymentMethodId], references: [id], onDelete: SetNull)

  items TransactionItem[]

  @@map("transactions")
}

model TransactionItem {
  id            Int     @id @default(autoincrement())
  transactionId Int     @map("transaction_id")
  menuId        Int     @map("menu_id")
  qty           Int
  price         Decimal @db.Decimal(12, 2)
  discount      Decimal? @db.Decimal(12, 2)

  transaction Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  menu        Menu        @relation(fields: [menuId], references: [id], onDelete: Restrict)

  variants      TransactionItemVariant[]
  kitchenOrders KitchenOrder[]

  @@map("transaction_items")
}

model TransactionItemVariant {
  id                Int     @id @default(autoincrement())
  transactionItemId Int     @map("transaction_item_id")
  menuVariantId     Int     @map("menu_variant_id")
  extraPrice        Decimal @db.Decimal(12, 2) @default(0) @map("extra_price")

  transactionItem TransactionItem @relation(fields: [transactionItemId], references: [id], onDelete: Cascade)
  menuVariant     MenuVariant     @relation(fields: [menuVariantId], references: [id], onDelete: Restrict)

  @@unique([transactionItemId, menuVariantId])
  @@map("transaction_item_variants")
}
